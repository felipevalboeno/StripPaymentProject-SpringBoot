<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pagamento com Stripe</title>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        /* ====== Layout base ====== */
        body {
            font-family: "Inter", Arial, sans-serif;
            background: #f5f7fb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        /* ====== Card principal ====== */
        .container {
            background: #fff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            width: 380px;
            text-align: center;
        }

        h2 {
            color: #333;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* ====== Campos ====== */
        label {
            display: block;
            text-align: left;
            font-size: 14px;
            color: #444;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #d0d0d0;
            border-radius: 6px;
            font-size: 15px;
            margin-bottom: 15px;
            outline: none;
            transition: border 0.2s;
        }

        input[type="number"]:focus {
            border-color: #6772e5;
        }

        #card-element {
            border: 1px solid #d0d0d0;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        /* ====== Bot√£o ====== */
        button {
            background: #6772e5;
            color: white;
            border: none;
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            letter-spacing: 0.3px;
            transition: background 0.3s, transform 0.1s;
        }

        button:hover {
            background: #5469d4;
        }

        button:active {
            transform: scale(0.98);
        }

        /* ====== Texto informativo ====== */
        .ptext {
            font-size: 12px;
            color: rgba(0, 0, 0, 0.45);
            margin: 0.2rem 0;
        }

        /* ====== Mensagem ====== */
        #mensagem {
            margin-top: 15px;
            font-size: 14px;
            font-weight: 500;
        }

        #mensagem.sucesso {
            color: #28a745;
        }

        #mensagem.erro {
            color: #dc3545;
        }

        .msg {
       display: none;  /* escondido por padr√£o */
    padding: 10px 15px;
    border-radius: 8px;
    background-color: #28a745;
    color: white;
    font-weight: 500;
    margin-top: 15px;
}

        
    </style>
</head>
<body>
<div class="container">
    <h2>üí≥ Pagamento com Stripe</h2>

    <form id="payment-form">
        <label for="valor">Valor (R$):</label>
        <input type="number" id="valor" value="10.00" min="1" step="0.01">

        <label>Informa√ß√µes do cart√£o:</label>
        <div id="card-element"></div>

        <p class="ptext">Cart√£o para teste: 4242 4242 4242 4242</p>
        <p class="ptext">Data: 02/33, CVV: 123 e CEP: 12345</p>

        <button type="submit">Pagar</button>
    </form>

  
        
    <p id="mensagem" class="msg"></p>
</div>



<script th:inline="javascript">
/*<![CDATA[*/
   const stripe = Stripe([[${stripePublicKey}]]);
    const elements = stripe.elements();
    const card = elements.create('card');
    card.mount('#card-element');

    const form = document.getElementById('payment-form');
    const mensagem = document.getElementById('mensagem');

    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const { token, error } = await stripe.createToken(card);
        if (error) {
            mensagem.textContent = error.message;
        } else {
            const valor = parseFloat(document.getElementById('valor').value);

            const resp = await fetch('/charge', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    stripeToken: token.id,
                    valor: valor
                })
            });

            // const txt = await resp.text();
            // mensagem.textContent = txt.slice(0, 2).join(' ');

            const txt = (await resp.text()).trim(); // remove espa√ßos extras no come√ßo/fim
const palavras = txt.split(/\s+/);      // divide a string em palavras
mensagem.textContent = palavras.slice(0, 2).join(' '); // pega s√≥ as 2 primeiras
mensagem.style.display = 'inline-block';
         
        }
    });
/*]]>*/
</script>
</body>
</html>
